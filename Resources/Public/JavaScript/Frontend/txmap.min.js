window.initializeGoogleMap=function(){txmap.googleMap.init()};$(document).ready(function(){txmap.geolocation.init()});var txmap=(function(){return{googleMap:(function(){var a={canvas:document.getElementById("tx_map_map_canvas"),setup:document.getElementById("tx_map_map_setup"),menu:document.getElementById("tx_map_map_menu")};return{init:function(){if(a.canvas){txmap.googleMap.map=null;txmap.googleMap.overlays_markers=[];txmap.googleMap.overlays_registeredkeys=["markers"];txmap.googleMap.options={scroll:false,types:"roadmap",zoom:5};txmap.googleMap.getOptions(a.canvas);txmap.googleMap.getMap();txmap.googleMap.addListeners();txmap.googleMap.getOverlays()}else{}},getOptions:function(b){if(b){txmap.googleMap.options.center=txmap.googleMap.getOptionCenter($(b).data("optionsCenter"));txmap.googleMap.options.scroll=txmap.googleMap.getOptionScroll($(b).data("optionsScroll"));txmap.googleMap.options.typeId=txmap.googleMap.getOptionTypeId($(b).data("optionsTypes"));txmap.googleMap.options.zoom=txmap.googleMap.getOptionZoom($(b).data("optionsZoom"))}},getMap:function(){var b={center:txmap.googleMap.options.center,scrollwheel:txmap.googleMap.options.scroll,mapTypeId:txmap.googleMap.options.typeId,zoom:txmap.googleMap.options.zoom};txmap.googleMap.map=new google.maps.Map(a.canvas,b)},addListeners:function(){txmap.googleMap.map.addListener("click",txmap.googleMap.enableScrollingWithMouseWheel);txmap.googleMap.map.addListener("drag",txmap.googleMap.enableScrollingWithMouseWheel);txmap.googleMap.map.addListener("mouseout",txmap.googleMap.disableScrollingWithMouseWheel)},getOverlays:function(){txmap.googleMap.fetchDefaultOverlayDataFromForm(a.setup,function(b){txmap.googleMap.addOverlays(b)})},getOptionCenter:function(d){if(typeof d!=="undefined"){var b=d.split(",");if(b.length>0){var e=b.splice(0,1).join("");var c=b.splice(0,2).join("");return new google.maps.LatLng(e,c)}}},getOptionScroll:function(b){return b},getOptionTypeId:function(c){if(typeof c!=="undefined"){var b=c.split(",");if(b.length>0){return b.splice(0,1).join("")}}},getOptionZoom:function(b){return parseInt(b)},fetchDefaultOverlayDataFromForm:function(b,c){$.post($(b).attr("action"),$(b).serialize(),function(e,d){c(e)},"json")},fetchRequestedOverlayDataForInfowindowByOverlayIdentifier:function(c,b){$.post($(a.setup).attr("action"),{tx_map_map:{overlay:"infowindow",identifier:b}},function(e,d){c(e)},"html")},refreshMapOverlays:function(){txmap.googleMap.clearMapOverlays();txmap.googleMap.fetchDefaultOverlayDataFromForm(a.menu,function(b){txmap.googleMap.addOverlays(b)})},addOverlays:function(b){$.each(b,function(c,d){if(txmap.googleMap.overlays_registeredkeys.indexOf(c)!=-1){switch(c){case"markers":txmap.googleMap.addOverlayMarkers(d);break}}})},addOverlayMarkers:function(b){var c=new google.maps.InfoWindow({content:""});$.each(b,function(e,g){markerLatLng=new google.maps.LatLng(g.latitude,g.longitude);var f=txmap.googleMap.getIcon(g.icon);var d=txmap.googleMap.getMarker(markerLatLng,f,g.title);google.maps.event.addListener(d,"click",function(){txmap.googleMap.fetchRequestedOverlayDataForInfowindowByOverlayIdentifier(function(h){c.setContent(h);c.open(txmap.googleMap.map,d)},g.identifier)});txmap.googleMap.overlays_markers.push(d)})},getIcon:function(b){var c={url:window.location.origin+"/"+b,anchor:new google.maps.Point(16,16)};return c},getMarker:function(b,d,e){var c=new google.maps.Marker({map:txmap.googleMap.map,position:markerLatLng,icon:d,title:e});return c},positionMarker:function(b,c){if(b!==null&&typeof b!=="undefined"&&c!==null&&typeof c!=="undefined"){c.setPosition(b)}},bindInfoWindow:function(b,d,c){google.maps.event.addListener(b,"click",function(){d.setContent(html);d.open(txmap.googleMap.map,b)})},clearMapOverlays:function(){while(txmap.googleMap.overlays_markers.length){txmap.googleMap.overlays_markers.pop().setMap(null)}txmap.googleMap.overlays_markers.length=0},enableScrollingWithMouseWheel:function(){txmap.googleMap.map.setOptions({scrollwheel:true})},disableScrollingWithMouseWheel:function(){txmap.googleMap.map.setOptions({scrollwheel:false})},openInfoWindow:function(d,b){if(txmap.googleMap.map!==null&&typeof txmap.googleMap.map!=="undefined"){var c=new google.maps.InfoWindow({content:d,position:b});c.open(txmap.googleMap.map)}}}})(),geolocation:(function(){var a={dataGeolocateSetupName:"data-geolocate-setup-name"};var b={};var c=null;return{init:function(){txmap.geolocation.getGeolocateSetups();if(b.length>0){txmap.geolocation.geolocate()}},getGeolocateSetups:function(){b=$("["+a.dataGeolocateSetupName+"]")},geolocate:function(){if(b.length>0){var e=$(b[0]).data("geolocateSetupTextErrorBrowser");var d=$(b[0]).data("geolocateSetupTextErrorGeolocation");var f=$(b[0]).data("geolocateSetupTextErrorGeolocationWatch");if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(h){for(index=0;index<b.length;++index){var l=$(b[index]).data("geolocateItem");var g=document.getElementById(l);var j=b[index];var i=$(b[index]).data("geolocateSetupName");var k=$(j).data("geolocateSetupPositionTrack");switch(i){case"map":txmap.geolocation.geolocateMap(h,self,g,j);if(k){navigator.geolocation.watchPosition(function(m){txmap.geolocation.geolocateMapTrack(m,self,g,j)},function(){txmap.geolocation.geolocationError(f)})}break;case"location_list":txmap.geolocation.geolocateLocationList(h,self,g,j);if(k){navigator.geolocation.watchPosition(function(m){txmap.geolocation.geolocateLocationListTrack(m,self,g,j)},function(){txmap.geolocation.geolocationError(f)})}break}}},function(){txmap.geolocation.geolocationError(d)},function(){txmap.geolocation.geolocationOptions()})}else{txmap.geolocation.geolocationError(e)}}},geolocateMap:function(h,n,f,m){if(typeof(h)!=="undefined"&&(txmap.googleMap.map!==null&&typeof txmap.googleMap.map!=="undefined")){var k=h.coords;var l=$(m).data("geolocateSetupItemLatitude");var e=document.getElementById(l);var g=$(m).data("geolocateSetupItemLongitude");var j=document.getElementById(g);var d=$(m).data("geolocateSetupPositionMarkerIconPath");var i=$(m).data("geolocateSetupTextMarkerTitle");if(k.latitude!==0&&k.longitude!==0){$(e).val(k.latitude);$(j).val(k.longitude)}$(document).ajaxStart(function(){$(f).loadOverlayStart()}).ajaxStop(function(){$(f).loadOverlayStop()});$.post($(m).attr("action"),$(m).serialize(),function(p,o){},"json").done(function(t){$(f).loadOverlayStop();if(t.geoLocation&&t.nearestLocation){var q=new google.maps.LatLng(t.geoLocation.latitude,t.geoLocation.longitude);var o=txmap.googleMap.getIcon(d);c=new google.maps.Marker({map:txmap.googleMap.map,position:q,icon:o,title:i});var v=new google.maps.LatLng(t.nearestLocation.latitude,t.nearestLocation.longitude);var u=new Array(q,v);var s=new google.maps.LatLngBounds();for(var r=0,p=u.length;r<p;r++){s.extend(u[r])}txmap.googleMap.map.fitBounds(s);txmap.googleMap.overlays_markers.push(c)}}).fail(function(o){console.warn("ERROR#1486553585(txmap.geolocation.geolocateMap>post)")})}},geolocateLocationList:function(g,l,e,k){if(typeof(g)!=="undefined"){var i=g.coords;var j=$(k).data("geolocateSetupLatitude");var d=document.getElementById(j);var f=$(k).data("geolocateSetupLongitude");var h=document.getElementById(f);if(i.latitude!==0&&i.longitude!==0){$(d).val(i.latitude);$(h).val(i.longitude)}$(document).ajaxStart(function(){$(e).loadOverlayStart()}).ajaxStop(function(){$(e).loadOverlayStop()});$.post($(k).attr("action"),$(k).serialize(),function(n,m){},"html").done(function(m){$(e).loadOverlayStop();$(e).replaceWith(m)}).fail(function(m){console.warn("ERROR#1486553584(txmap.geolocation.geolocateLocationList>post)")})}},geolocateMapTrack:function(e,f,d,h){if(txmap.googleMap.map!==null&&typeof txmap.googleMap.map!=="undefined"&&c!==null&&typeof c!=="undefined"&&e.coords.latitude!==0&&e.coords.latitude!=="undefined"&&e.coords.longitude!==0&&e.coords.longitude!=="undefined"){var g=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);txmap.googleMap.positionMarker(g,c)}else{console.warn("WARNING#1486553583(txmap.geolocation.geolocateLocationListTrack) No support for tracking location list yet.")}},geolocateLocationListTrack:function(e,f,d,g){console.warn("WARNING#1486553582(txmap.geolocation.geolocateLocationListTrack) No support for tracking location list yet.")},geolocateClearWatch:function(d){navigator.geolocation.clearWatch(d)},geolocationError:function(d){console.warn("ERROR#1486553581(txmap.geolocation.geolocationError) "+d);if(txmap.googleMap.map!==null&&typeof txmap.googleMap.map!=="undefined"){txmap.googleMap.openInfoWindow(d,txmap.googleMap.map.getCenter())}},geolocationOptions:function(){return{}}}})(),loadOverlay:(function(a){a.fn.loadOverlayStart=function(){if(!this.length){return(this)}if(this.data("loadOver")){return(this)}var e,d,c=0,b,i=this,g=function(){var j;var k={};if(i.height()){k.position="absolute";k.width=i.outerWidth();j=a("body");k.top=i.offset().top;k.left=i.offset().left;k.height=i.outerHeight()}else{k.height=100;k.position="relative";k.width="100%";j=i;k.top=0;k.left=0}e=a('<div class="tx-map-loadOverOverlay"><div class="tx-map-loadOver"><div class="tx-map-loadOverDiv"></div></div></div>');e.css(k);e.appendTo(j);clearInterval(d);e.show();d=setInterval(f,66)},f=function(){if(!e.length||!e.is(":visible")){h();return}c=c+1;if(c>11){c=0}},h=function(){clearInterval(d);e.remove();i.data("loadOver",false);i.data("stopFunc",undefined)};g();this.data("stopFunc",h).data("loadOver",true);return(this)};a.fn.loadOverlayStop=function(){if(!this.length){return(this)}var b=this.data("stopFunc");if(!b){return(this)}b();return(this)}})(jQuery)}})();