window.initializeGoogleMap=function(){txmap.googleMap.init()},$(document).ready(function(){txmap.geolocation.init()});var txmap={googleMap:function(){var o={canvas:document.getElementById("tx_map_map_canvas"),setup:document.getElementById("tx_map_map_setup"),menu:document.getElementById("tx_map_map_menu")};return{init:function(){o.canvas&&(txmap.googleMap.map=null,txmap.googleMap.overlays_markers=[],txmap.googleMap.overlays_registeredkeys=["markers"],txmap.googleMap.options={scroll:!1,types:"roadmap",zoom:5},txmap.googleMap.getOptions(o.canvas),txmap.googleMap.getMap(),txmap.googleMap.addListeners(),txmap.googleMap.getOverlays())},getOptions:function(o){o&&(txmap.googleMap.options.center=txmap.googleMap.getOptionCenter($(o).data("optionsCenter")),txmap.googleMap.options.scroll=txmap.googleMap.getOptionScroll($(o).data("optionsScroll")),txmap.googleMap.options.typeId=txmap.googleMap.getOptionTypeId($(o).data("optionsTypes")),txmap.googleMap.options.zoom=txmap.googleMap.getOptionZoom($(o).data("optionsZoom")))},getMap:function(){var t={center:txmap.googleMap.options.center,scrollwheel:txmap.googleMap.options.scroll,mapTypeId:txmap.googleMap.options.typeId,zoom:txmap.googleMap.options.zoom};txmap.googleMap.map=new google.maps.Map(o.canvas,t)},addListeners:function(){txmap.googleMap.map.addListener("click",txmap.googleMap.enableScrollingWithMouseWheel),txmap.googleMap.map.addListener("drag",txmap.googleMap.enableScrollingWithMouseWheel),txmap.googleMap.map.addListener("mouseout",txmap.googleMap.disableScrollingWithMouseWheel)},getOverlays:function(){txmap.googleMap.fetchDefaultOverlayDataFromForm(o.setup,function(o){txmap.googleMap.addOverlays(o)})},getOptionCenter:function(o){if(void 0!==o){var t=o.split(",");if(t.length>0){var e=t.splice(0,1).join(""),a=t.splice(0,2).join("");return new google.maps.LatLng(e,a)}}},getOptionScroll:function(o){return o},getOptionTypeId:function(o){if(void 0!==o){var t=o.split(",");if(t.length>0)return t.splice(0,1).join("")}},getOptionZoom:function(o){return parseInt(o)},fetchDefaultOverlayDataFromForm:function(o,t){$.post($(o).attr("action"),$(o).serialize(),function(o,e){t(o)},"json")},fetchRequestedOverlayDataForInfowindowByOverlayIdentifier:function(t,e){$.post($(o.setup).attr("action"),{tx_map_map:{overlay:"infowindow",identifier:e}},function(o,e){t(o)},"html")},refreshMapOverlays:function(){txmap.googleMap.clearMapOverlays(),txmap.googleMap.fetchDefaultOverlayDataFromForm(o.menu,function(o){txmap.googleMap.addOverlays(o)})},addOverlays:function(o){$.each(o,function(o,t){if(-1!=txmap.googleMap.overlays_registeredkeys.indexOf(o))switch(o){case"markers":txmap.googleMap.addOverlayMarkers(t)}})},addOverlayMarkers:function(o){var t=new google.maps.InfoWindow({content:""});$.each(o,function(o,e){markerLatLng=new google.maps.LatLng(e.latitude,e.longitude);var a=txmap.googleMap.getIcon(e.icon),n=txmap.googleMap.getMarker(markerLatLng,a,e.title);google.maps.event.addListener(n,"click",function(){txmap.googleMap.fetchRequestedOverlayDataForInfowindowByOverlayIdentifier(function(o){t.setContent(o),t.open(txmap.googleMap.map,n)},e.identifier)}),txmap.googleMap.overlays_markers.push(n)})},getIcon:function(o){return{url:window.location.origin+"/"+o,anchor:new google.maps.Point(16,16)}},getMarker:function(o,t,e){return new google.maps.Marker({map:txmap.googleMap.map,position:markerLatLng,icon:t,title:e})},positionMarker:function(o,t){null!==o&&void 0!==o&&null!==t&&void 0!==t&&t.setPosition(o)},bindInfoWindow:function(o,t,e){google.maps.event.addListener(o,"click",function(){t.setContent(html),t.open(txmap.googleMap.map,o)})},clearMapOverlays:function(){for(;txmap.googleMap.overlays_markers.length;)txmap.googleMap.overlays_markers.pop().setMap(null);txmap.googleMap.overlays_markers.length=0},enableScrollingWithMouseWheel:function(){txmap.googleMap.map.setOptions({scrollwheel:!0})},disableScrollingWithMouseWheel:function(){txmap.googleMap.map.setOptions({scrollwheel:!1})},openInfoWindow:function(o,t){null!==txmap.googleMap.map&&void 0!==txmap.googleMap.map&&new google.maps.InfoWindow({content:o,position:t}).open(txmap.googleMap.map)}}}(),geolocation:function(){var o={dataGeolocateSetupName:"data-geolocate-setup-name"},t={};return{init:function(){txmap.geolocation.getGeolocateSetups(),t.length>0&&txmap.geolocation.geolocate()},getGeolocateSetups:function(){t=$("["+o.dataGeolocateSetupName+"]")},geolocate:function(){if(t.length>0){var o=$(t[0]).data("geolocateSetupTextErrorBrowser"),e=$(t[0]).data("geolocateSetupTextErrorGeolocation"),a=$(t[0]).data("geolocateSetupTextErrorGeolocationWatch");navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){for(index=0;index<t.length;++index){var e=$(t[index]).data("geolocateItem"),n=document.getElementById(e),i=t[index],l=$(t[index]).data("geolocateSetupName"),p=$(i).data("geolocateSetupPositionTrack");switch(l){case"map":txmap.geolocation.geolocateMap(o,self,n,i),p&&navigator.geolocation.watchPosition(function(o){txmap.geolocation.geolocateMapTrack(o,self,n,i)},function(){txmap.geolocation.geolocationError(a)});break;case"location_list":txmap.geolocation.geolocateLocationList(o,self,n,i),p&&navigator.geolocation.watchPosition(function(o){txmap.geolocation.geolocateLocationListTrack(o,self,n,i)},function(){txmap.geolocation.geolocationError(a)})}}},function(){txmap.geolocation.geolocationError(e)},function(){txmap.geolocation.geolocationOptions()}):txmap.geolocation.geolocationError(o)}},geolocateMap:function(o,t,e,a){if(void 0!==o&&null!==txmap.googleMap.map&&void 0!==txmap.googleMap.map){var n=o.coords,i=$(a).data("geolocateSetupItemLatitude"),l=document.getElementById(i),p=$(a).data("geolocateSetupItemLongitude"),g=document.getElementById(p),r=$(a).data("geolocateSetupPositionMarkerIconPath"),c=$(a).data("geolocateSetupTextMarkerTitle");0!==n.latitude&&0!==n.longitude&&($(l).val(n.latitude),$(g).val(n.longitude)),$(document).ajaxStart(function(){$(e).loadOverlayStart()}).ajaxStop(function(){$(e).loadOverlayStop()}),$.post($(a).attr("action"),$(a).serialize(),function(o,t){},"json").done(function(o){if($(e).loadOverlayStop(),o.geoLocation&&o.nearestLocation){for(var t=new google.maps.LatLng(o.geoLocation.latitude,o.geoLocation.longitude),a=txmap.googleMap.getIcon(r),n=new google.maps.Marker({map:txmap.googleMap.map,position:t,icon:a,title:c}),i=new google.maps.LatLng(o.nearestLocation.latitude,o.nearestLocation.longitude),l=new Array(t,i),p=new google.maps.LatLngBounds,g=0,s=l.length;g<s;g++)p.extend(l[g]);txmap.googleMap.map.fitBounds(p),txmap.googleMap.overlays_markers.push(n)}}).fail(function(o){console.warn("ERROR#1486553585(txmap.geolocation.geolocateMap>post)")})}},geolocateLocationList:function(o,t,e,a){if(void 0!==o){var n=o.coords,i=$(a).data("geolocateSetupLatitude"),l=document.getElementById(i),p=$(a).data("geolocateSetupLongitude"),g=document.getElementById(p);0!==n.latitude&&0!==n.longitude&&($(l).val(n.latitude),$(g).val(n.longitude)),$(document).ajaxStart(function(){$(e).loadOverlayStart()}).ajaxStop(function(){$(e).loadOverlayStop()}),$.post($(a).attr("action"),$(a).serialize(),function(o,t){},"html").done(function(o){$(e).loadOverlayStop(),$(e).replaceWith(o)}).fail(function(o){console.warn("ERROR#1486553584(txmap.geolocation.geolocateLocationList>post)")})}},geolocateMapTrack:function(o,t,e,a){if(null!==txmap.googleMap.map&&txmap.googleMap.map,1)console.warn("WARNING#1486553583(txmap.geolocation.geolocateLocationListTrack) No support for tracking location list yet.");else{var n=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);txmap.googleMap.positionMarker(n,null)}},geolocateLocationListTrack:function(o,t,e,a){console.warn("WARNING#1486553582(txmap.geolocation.geolocateLocationListTrack) No support for tracking location list yet.")},geolocateClearWatch:function(o){navigator.geolocation.clearWatch(o)},geolocationError:function(o){console.warn("ERROR#1486553581(txmap.geolocation.geolocationError) "+o),null!==txmap.googleMap.map&&void 0!==txmap.googleMap.map&&txmap.googleMap.openInfoWindow(o,txmap.googleMap.map.getCenter())},geolocationOptions:function(){return{}}}}(),loadOverlay:function(o){o.fn.loadOverlayStart=function(){if(!this.length)return this;if(this.data("loadOver"))return this;var t,e,a=0,n=this,i=function(){t.length&&t.is(":visible")?(a+=1)>11&&(a=0):l()},l=function(){clearInterval(e),t.remove(),n.data("loadOver",!1),n.data("stopFunc",void 0)};return function(){var a,l={};n.height()?(l.position="absolute",l.width=n.outerWidth(),a=o("body"),l.top=n.offset().top,l.left=n.offset().left,l.height=n.outerHeight()):(l.height=100,l.position="relative",l.width="100%",a=n,l.top=0,l.left=0),(t=o('<div class="tx-map-loadOverOverlay"><div class="tx-map-loadOver"><div class="tx-map-loadOverDiv"></div></div></div>')).css(l),t.appendTo(a),clearInterval(e),t.show(),e=setInterval(i,66)}(),this.data("stopFunc",l).data("loadOver",!0),this},o.fn.loadOverlayStop=function(){if(!this.length)return this;var o=this.data("stopFunc");return o?(o(),this):this}}(jQuery)};