var _TXMAP_FORM=[];var _TXMAP_MAP;var initTxMapForm=function(){_TXMAP_FORM=TYPO3.jQuery(document.getElementById("tx_map_map_control")).data();_TXMAP_FORM.mapDefaultZoom=_TXMAP_FORM.mapDefaultZoom>0?_TXMAP_FORM.mapDefaultZoom:10;_TXMAP_FORM.entryFieldPath="data["+_TXMAP_FORM.entryTable+"]["+_TXMAP_FORM.entryUid+"]";_TXMAP_FORM.entryFieldLatitude=convertEntryFieldName(_TXMAP_FORM.entryFieldLatitude);_TXMAP_FORM.entryFieldLongitude=convertEntryFieldName(_TXMAP_FORM.entryFieldLongitude);_TXMAP_FORM.entryFieldZoom=convertEntryFieldName(_TXMAP_FORM.entryFieldZoom);renewMapOptionZoom()};var convertEntryFieldName=function(a){if(a){if(a.indexOf("[")!=0){return"["+a.split("/").join("][")+"]"}else{return a}}else{return null}};var renewMapOptionZoom=function(){if(_TXMAP_FORM.entryFieldZoom&&TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldZoom+"']").val()){_TXMAP_FORM.mapDefaultZoom=TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldZoom+"']").val();_TXMAP_FORM.mapDefaultZoom=_TXMAP_FORM.mapDefaultZoom>0?_TXMAP_FORM.mapDefaultZoom:10}};var doGeocoding=function(){var e="";var a="";var d="";var c="";if(TYPO3.jQuery&&TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+"[address]']")){e=TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+"[address]']").val();a=TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+"[zip]']").val();d=TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+"[city]']").val();c=TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+"[country]']").val()}var b=new gmaps();b.setAddress(e,a,d,c);b.fetchCoordinatesByAddress(resultsHandling)};var resultsHandling=function(b,a){if(typeof(b)=="number"&&typeof(a)=="number"){if(TYPO3.jQuery&&TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']")){TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']").val(b);TYPO3.jQuery("input[name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']").val(b);TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLongitude+"']").val(a);TYPO3.jQuery("input[name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLongitude+"']").val(a)}}else{alert("Given address could not been fetched! #1473353090")}renderMap(b,a)};var displayMap=function(){enableOptions();initTxMapForm();var a=getCoordinates();renderMap(a.latitude,a.longitude)};var closeMap=function(){disableOptions();TYPO3.jQuery(document.getElementById(_TXMAP_FORM.mapElementId)).hide();_TXMAP_FORM=[]};var fetchZoom=function(){renewMapOptionZoom();_TXMAP_MAP.setZoom(parseInt(_TXMAP_FORM.mapDefaultZoom))};var getCoordinates=function(){var a=[];a.latitude=0;a.longitude=0;if(TYPO3.jQuery&&TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']").val()){a.latitude=parseFloat(TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']").val());a.longitude=parseFloat(TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLongitude+"']").val())}return a};var renderMap=function(e,c){if(typeof(e)!=="number"&&typeof(c)!=="number"){if(typeof(_TXMAP_FORM.entryDefaultLatitude)=="number"&&typeof(_TXMAP_FORM.entryDefaultLongitude)=="number"){e=parseFloat(_TXMAP_FORM.entryDefaultLatitude);c=parseFloat(_TXMAP_FORM.entryDefaultLongitude)}}if(typeof(e)=="number"&&typeof(c)=="number"){document.getElementById(_TXMAP_FORM.mapElementId).setAttribute("style","height:300px; border:1px solid #BBBBBB; ",false);var d=new google.maps.LatLng(e,c);var b={center:d,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:false,zoom:parseInt(_TXMAP_FORM.mapDefaultZoom)};_TXMAP_MAP=new google.maps.Map(document.getElementById(_TXMAP_FORM.mapElementId),b);_TXMAP_MAP.addListener("click",enableScrollingWithMouseWheel);_TXMAP_MAP.addListener("drag",enableScrollingWithMouseWheel);_TXMAP_MAP.addListener("mouseout",disableScrollingWithMouseWheel);var a=new google.maps.Marker({position:d,draggable:true,title:""});google.maps.event.addListener(a,"dragend",function(){if(TYPO3.jQuery&&TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']")){TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']").val(a.getPosition().lat());TYPO3.jQuery("input[name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLatitude+"']").val(a.getPosition().lat());TYPO3.jQuery("input[data-formengine-input-name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLongitude+"']").val(a.getPosition().lng());TYPO3.jQuery("input[name*='"+_TXMAP_FORM.entryFieldPath+_TXMAP_FORM.entryFieldLongitude+"']").val(a.getPosition().lng())}});a.setMap(_TXMAP_MAP)}else{alert("No coordinates found! #1473353093")}};var gmaps=function(){var b=this;var h=null;var d=null;var g=null;var f=null;var e=null;var c=null;function a(i){return i.replace(/^\s+/,"").replace(/\s+$/,"")}this.setStreet=function(i){if(typeof(i)=="string"&&""!=i){b.street=i}};this.getStreet=function(){return b.street};this.setZip=function(i){if(typeof(i)=="string"&&""!=i){b.zip=i}};this.getZip=function(){return b.zip};this.setCity=function(i){if(typeof(i)=="string"&&""!=i){b.city=i}};this.getCity=function(){return b.city};this.setCountry=function(i){if(typeof(i)=="string"&&""!=i){b.country=i}};this.getCountry=function(){return b.country};this.setLatitude=function(i){if(typeof(i)=="number"){b.lat=i}};this.getLatitude=function(){return b.lat};this.setLongitude=function(i){if(typeof(i)=="number"){b.lng=i}};this.getLongitude=function(){return b.lng};this.fetchCoordinatesByAddress=function(j){var i=new google.maps.Geocoder();if(i){i.geocode({address:this.getAddressAsString()},function(l,k){if(k==google.maps.GeocoderStatus.OK){b.setLatitude(l[0].geometry.location.lat());b.setLongitude(l[0].geometry.location.lng());j(b.getLatitude(),b.getLongitude())}})}};this.setAddress=function(l,i,k,j){b.setStreet(l);b.setZip(i);b.setCity(k);b.setCountry(j)};this.getAddressAsString=function(){var i=new Array();if(null!=b.getStreet()){i.push(b.getStreet())}if(null!=b.getZip()&&null!=b.getCity()){i.push(a(b.getZip()+" "+b.getCity()))}else{if(null!=b.getZip()){i.push(b.getZip())}else{if(null!=b.getCity()){i.push(b.getCity())}}}if(null!=b.getCountry()){i.push(b.getCountry())}var j=i.join(", ");return j};this.setCoordinates=function(j,i){b.lat=latitude;b.lng=longitude}};var enableScrollingWithMouseWheel=function(){_TXMAP_MAP.setOptions({scrollwheel:true})};var disableScrollingWithMouseWheel=function(){_TXMAP_MAP.setOptions({scrollwheel:false})};var enableOptions=function(){document.getElementById("tx_map_map_control_displaymap")?document.getElementById("tx_map_map_control_displaymap").style.display="none":"";document.getElementById("tx_map_map_control_closemap")?document.getElementById("tx_map_map_control_closemap").style.display="inline":"";document.getElementById("tx_map_map_control_dogeocoding")?document.getElementById("tx_map_map_control_dogeocoding").style.display="inline":"";document.getElementById("tx_map_map_control_fetchzoom")?document.getElementById("tx_map_map_control_fetchzoom").style.display="inline":""};var disableOptions=function(){document.getElementById("tx_map_map_control_displaymap")?document.getElementById("tx_map_map_control_displaymap").style.display="inline":"";document.getElementById("tx_map_map_control_closemap")?document.getElementById("tx_map_map_control_closemap").style.display="none":"";document.getElementById("tx_map_map_control_dogeocoding")?document.getElementById("tx_map_map_control_dogeocoding").style.display="none":"";document.getElementById("tx_map_map_control_fetchzoom")?document.getElementById("tx_map_map_control_fetchzoom").style.display="none":""};